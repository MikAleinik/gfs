Модуль загрузки и обработки данных GFS по облачности.
Для установки и работы модуля необходима операционная система CentOS 7 64-bit.

Установка:
1) Подключите репозиторий EPEL
	$ yum install epel-release*
2) Из репозитория EPEL выполните установку пакетов:
	1) gdal версии 1.11.4 или выше
		$ yum install gdal*
	2) gdal-libs версии 1.11.4 или выше
		$ yum install gdal*
	3) fcgi версии 2.4.0 или выше
		$ yum install fcgi*
	4) apache версии 2.4.6 или выше
		$ yum install httpd*
3) Из репозитория GitLab https://gitlab.com/Mik_Aleinik/gfs_cloud/ выполните установку пакета:
	1) gfs-cloud-1.1-1.x86_64.rpm
		$ yum install https://gitlab.com/Mik_Aleinik/gfs_cloud/-/raw/main/gfs-cloud-1.1-1.x86_64.rpm

Первоначальная настройка сервера Apache
1) Активируйте в брандмауэре службу http
	$ firewall-cmd --permanent --add-service=http
2) Активируйте в брандмауэре службу https
	$ firewall-cmd --permanent --add-service=https
3) Перезагрузите брандмауэр, чтобы новые правила начали действовать:
	$ firewall-cmd --reload
4) Запустите сервер Apache
	$ systemctl start httpd
5) Убедитель в том, что служба активна выполнив команду
	$ systemctl status httpd
	При положительном результате поле "Active" будет заполнено "active (running)"
6) Выполните проверку доступности сервера
	1) Выполните команду $ hostname -I
	2) При вводе каждого адреса, появившегося на экране после команды hostname -I, в строку браузера должна открываться тестовая страница с текстом "Testing 123.."
7) Откройте для редактирования файл /etc/httpd/conf/httpd.conf
	1) Найдите раздел "# Further relax access to the default document root"
	2) В поле "AllowOverride" измените значение "None" на "All"
	3) После строки "</Directory>" напишите
		<Directory "/var/www/html/gfs_cloud/">
			Options Indexes FollowSymLinks
			AllowOverride All
			Require all granted
		</Directory>
8) Сохраните выполненные изменения и проверьте правильность файла конфигурации
	$ httpd -t
9) Перезагрузите сервер Apache
	$ systemctl restart httpd

Первоначальная настройка модуля
1) В результате установки должна получиться следующая структура размещения файлов:
	1) /bin/gdal_translate
	2) /bin/gdalwarp
	3) /var/www/html/gfs_cloud/loader.sh
	4) /var/www/html/gfs_cloud/.htaccess
	5) /var/www/html/gfs_cloud/index.php
	6) /var/www/cgi-bin/mapserv
	7) /etc/cron.d/gfs_cloud
	8) /usr/share/proj/epsg
2) В файле /var/www/html/gfs_cloud/loader.sh найти раздел #Каталоги в строке onlineUrl указать Ваш адрес при доступе из интернета (например: http://192.168.1.60/gfs_cloud/)

В случае не возможности установки модуля из репозитория, установите самостоятельно файлы в соответствии со структурой каталогов и выполните остальные действия данной инструкции. В случае установки самостоятельно требуется создать файл планировщика запуска модуля по времени в каталоге /etc/cron.d/gfs_cloud с периодом запуска 59 */6 * * *

Проверка проверка работоспособности установленного модуля.
1) Для проверки правильности установки и настройки можно воспользоваться ГИС приложением (на примере QGIS)
	1) Выполните в командной строке запуск модуля /var/www/html/gfs_cloud/bash loader.sh
	2) Загрузите приложение QGIS
	3) Установите слой OSM. Пункт меню Internet -> QuickMapService -> OSM -> OSM Standart
	4) Установите слой созданного WMS сервиса:
		1) Пункт меню Layer -> Add layer -> Add layer WMS/WMTS
		2) В открывшемся окне "Data Source Manager | WMS" выберите "Создать"
		3) В открывшемся окне "Create a new WMS connection" введите название "test_layer" и адрес ресурса "http://XXX.XXX.XXX.XXX/gfs_cloud/wmsmapYYYYMMDD_HH_00". Где XXX.XXX.XXX.XXX адрес созданного сервера, YYYYMMDD_HH текущие дата и час (YYYY - год, MM - месяц, DD - день, HH - час)
		4) В открывшемся окне "Data Source Manager | WMS" выберите "Подключиться"
		5) В открывшемся окне "Data Source Manager | WMS" в списке доступных слоев выберите 1 слой (clouding / gfs clouding) и установите формат изображения PNG
	5) В результате на слой OSM будет наложен слой облачности на текущую дату и время.
2) При отсутствии установленных ГИС приложений для проверки работоспобности необходимо
	1) Выполните в командной строке запуск модуля /var/www/html/gfs_cloud/bash loader.sh
	2) В браузере введите следующую строку (с внесенными данными Вашего сервера, где XXX.XXX.XXX.XXX - адрес созданного сервера, YYYYMMDD_HH текущие дата и время YYYY - год, MM - месяц, DD - день, HH - час)
http://XXX.XXX.XXX.XXX/gfs_cloud/wmsmapYYYYMMDD_HH_00/?SERVICE=WMS&REQUEST=GetMap&VERSION=1.1.1&LAYERS=clouding&STYLES=&transparent=true&FORMAT=image%2Fpng&HEIGHT=256&WIDTH=256&SRS=EPSG%3A3857&HEIGHT=256&WIDTH=256&BBOX=6261721.357119974,6261721.357119974,6887893.4928319715,6887893.4928319715
	3) При правильно настроенном сервере в окне браузера отобразится квадратная картинка серого цвета.

Использование API
В общем случае строка запроса должна иметь следующий вид:
http://XXX.XXX.XXX.XXX/gfs_cloud/wmsmap20210914_09_00/?SERVICE=WMS&REQUEST=GetMap&VERSION=1.1.1&LAYERS=clouding&STYLES=&transparent=true&FORMAT=image%2Fpng&HEIGHT=256&WIDTH=256&SRS=EPSG%3A3857&HEIGHT=256&WIDTH=256&BBOX=6261721.357119974,6261721.357119974,6887893.4928319715,6887893.4928319715
Для получения данных запрос должен содержать следующие данные:
1) wmsmap20210914_09_00 - зарезервированное слово (wmsmap) и необходимые для прогноза дата и время (20210914_09_00 - 09 часов 14.09.2021).
2) SERVICE - название сервиса (WMS)
3) REQUEST - тип запроса (GetMap)
4) VERSION - версия WMS сервиса (1.1.1)
5) LAYERS - название слоя (clouding)
6) transparent - прозрачность слоя (true)
7) FORMAT - формат изображения (image/png)
8) HEIGHT - размер тайла (256)
9) WIDTH - размер тайла (256)
10) SRS - тип проекции (EPSG:3857)
11) BBOX - координаты участка для отоборажения (6261721.357119974,6261721.357119974,6887893.4928319715,6887893.4928319715)
Более детальную информацию о протоколе WMS возможно изучить https://www.ogc.org/standards/wms

Дополнительные настройки производятся в файле loader.sh изменением соответствующих параметров.
1) Изменение набора слоев.
	Для изменения набора слоев облачности в разделе "#Список слоев для загрузки" установите значение параметра layers около необходимого для загрузки слоя на "on" . Все указанные для загрузки слои компонуются в один файл.
2) Изменение координат
	Для изменения коодинат области в разделе "#Координаты области для загрузки" требуется указать долготу и широту около соответствующих параметров: leftlon - левая граница от 0 до 360, rightlon - правая граница от 0 до 360, toplat - верхняя граница от -90 до 90, bottomlat - нижняя граница от -90 до 90.
3) Изменение длительности периода прогнозных данных.
	Для изменения периода загрузки прогнозных данных в разделе "#Количество часов прогноза (1 - 384)" установите значение параметра durationForecast на необходимое в диапазоне от 1 до 384. Начиная от значения 120 загрузка данных происходит с шагом 3 часа.
4) Длительность хранения загруженных данных.
	Для изменения периода хранения данных в разделе "#Длительность хранения файлов в днях" установите значение параметра durationStorageFile на необходимое в днях.
5) Изменение системы координат.
	Для изменения системы геодезических координат в разделе "#Система геодезических координат" установите требуемые значения параметров typeWGS и typeEPSG.
6) Изменение цвета облачности.
	Для изменения цвета облачности в разделе "#Цвет отображения облачности" установите в параметре color необходимый цвет в формате "R G B".
При внесении изменений ранее загруженные данные изменениям не подвергнутся. Все установленные параметры будут применены к файлам загружаемым в дальнейшем.